<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11-2 Unit 1 ‚Äî Week 1 Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Serif+4:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --red: #CC0000; --red-dark: #990000; --green: #1B4D2E;
            --green-mid: #2D6E47; --gold: #C9A84C; --cream: #FAF7F2;
            --gray-light: #F0EDE8; --gray: #8A8580; --text: #1A1A1A;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Source Serif 4',Georgia,serif; background:var(--green); min-height:100vh; padding:30px 20px; color:var(--text); user-select:none; -webkit-user-select:none; }
        .timer { position:fixed; top:20px; right:20px; background:var(--green); color:white; padding:10px 20px; border-radius:8px; font-family:'Playfair Display',serif; font-size:18px; font-weight:700; border:2px solid var(--gold); box-shadow:0 4px 12px rgba(0,0,0,.3); z-index:100; text-align:center; }
        .timer-label { display:block; font-size:9px; text-transform:uppercase; letter-spacing:1.5px; color:var(--gold); margin-bottom:2px; font-family:'Source Serif 4',serif; }
        .tab-overlay { display:none; position:fixed; inset:0; background:rgba(10,5,5,.96); z-index:9000; justify-content:center; align-items:center; flex-direction:column; gap:16px; color:white; text-align:center; padding:20px; }
        .tab-overlay.show { display:flex; }
        .tab-overlay .icon { font-size:56px; animation:pulse 1s infinite; }
        .tab-overlay h2 { font-family:'Playfair Display',serif; font-size:26px; color:#FF4444; }
        .tab-overlay p { font-size:15px; color:rgba(255,255,255,.8); max-width:340px; }
        .tab-overlay .vcount { background:var(--red); padding:7px 22px; border-radius:20px; font-weight:700; }
        @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.1)} }
        .warning-banner { display:none; background:var(--red); color:white; padding:12px 18px; border-radius:8px; font-weight:600; font-size:14px; margin-bottom:18px; text-align:center; }
        .submitted-msg { display:none; background:#EDFAF2; border:2px solid var(--green); color:var(--green); padding:13px; border-radius:8px; font-weight:600; text-align:center; margin-bottom:20px; }
        .unanswered-msg { display:none; background:#FFF0F0; border:2px solid var(--red); color:var(--red-dark); padding:13px 18px; border-radius:8px; font-weight:600; font-size:14px; margin-bottom:18px; }
        .school-band { max-width:860px; margin:0 auto; background:var(--red); border-radius:12px 12px 0 0; padding:13px 28px; display:flex; align-items:center; justify-content:space-between; }
        .school-band .name { font-family:'Playfair Display',serif; color:white; font-size:16px; font-weight:700; }
        .quiz-wrap { max-width:860px; margin:0 auto; background:white; border-radius:0 0 16px 16px; box-shadow:0 12px 48px rgba(0,0,0,.2); overflow:hidden; }
        .quiz-inner { padding:36px 44px 48px; }
        .quiz-header { text-align:center; margin-bottom:32px; }
        .quiz-header h1 { font-family:'Playfair Display',serif; color:var(--green); font-size:28px; margin-bottom:6px; }
        .quiz-header .sub { font-size:13px; color:var(--gray); font-style:italic; }
        .divider { display:flex; align-items:center; gap:12px; margin:14px 0; }
        .divider::before { content:''; flex:1; height:2px; background:linear-gradient(to right,transparent,var(--red)); }
        .divider::after  { content:''; flex:1; height:2px; background:linear-gradient(to left,transparent,var(--red)); }
        .student-info { display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:18px; padding-top:18px; border-top:2px solid var(--gray-light); }
        .info-field label { display:block; font-size:11px; font-weight:600; color:var(--green); text-transform:uppercase; letter-spacing:1px; margin-bottom:5px; }
        .info-field input { width:100%; padding:9px 13px; border:2px solid #DDD; border-radius:6px; font-family:inherit; font-size:15px; background:var(--cream); user-select:text; -webkit-user-select:text; }
        .info-field input:focus { outline:none; border-color:var(--red); }
        .integrity-notice { background:#FFF8F0; border:2px solid var(--red); border-radius:10px; padding:20px 22px; margin-bottom:28px; }
        .integrity-notice h3 { font-family:'Playfair Display',serif; color:var(--red); font-size:16px; margin-bottom:12px; }
        .rule { display:flex; gap:11px; align-items:flex-start; font-size:13.5px; color:#333; line-height:1.5; margin-bottom:8px; }
        .rule:last-child { margin-bottom:0; }
        .rule-icon { font-size:16px; flex-shrink:0; margin-top:1px; }
        .section { margin-bottom:32px; }
        .section-head { background:var(--green); border-radius:10px 10px 0 0; padding:13px 22px; }
        .sec-title { font-family:'Playfair Display',serif; color:white; font-size:18px; font-weight:700; }
        .sec-title span { background:var(--red); font-family:'Source Serif 4',serif; font-size:11px; font-weight:600; letter-spacing:1px; text-transform:uppercase; padding:2px 9px; border-radius:20px; margin-left:8px; vertical-align:middle; }
        .sec-desc { color:rgba(255,255,255,.82); font-size:13px; font-style:italic; margin-top:3px; }
        .section-body { background:var(--cream); border:2px solid var(--green); border-top:none; border-radius:0 0 10px 10px; padding:20px; display:flex; flex-direction:column; gap:14px; }
        .q-card { background:white; border-radius:8px; padding:18px 20px; box-shadow:0 2px 8px rgba(0,0,0,.07); border-left:4px solid var(--gold); }
        .q-card.unanswered { border-left-color:var(--red)!important; background:#FFF5F5!important; animation:shake .4s ease; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 20%{transform:translateX(-5px)} 40%{transform:translateX(5px)} 60%{transform:translateX(-3px)} 80%{transform:translateX(3px)} }
        .q-num { font-size:12px; font-weight:700; color:var(--red); text-transform:uppercase; letter-spacing:1px; margin-bottom:5px; }
        .q-text { font-size:15px; line-height:1.6; margin-bottom:13px; }
        .options { display:flex; flex-direction:column; gap:7px; }
        .opt { display:flex; align-items:center; gap:11px; padding:10px 14px; background:var(--gray-light); border-radius:6px; cursor:pointer; border:2px solid transparent; font-size:14px; transition:all .15s; }
        .opt:hover { background:#E8F0EB; border-color:var(--green-mid); }
        .opt.selected { background:#FFEAEA; border-color:var(--red); }
        .opt input { accent-color:var(--red); cursor:pointer; }
        .tf-opts { display:flex; gap:14px; }
        .tf-opt { display:flex; align-items:center; gap:9px; padding:10px 22px; background:var(--gray-light); border-radius:6px; cursor:pointer; border:2px solid transparent; font-size:14px; font-weight:600; transition:all .15s; }
        .tf-opt:hover { background:#E8F0EB; border-color:var(--green-mid); }
        .tf-opt.selected { background:#FFEAEA; border-color:var(--red); }
        .tf-opt input { accent-color:var(--red); cursor:pointer; }
        .match-item { background:white; border-radius:8px; padding:14px 18px; display:grid; grid-template-columns:32px 1fr auto; align-items:center; gap:14px; box-shadow:0 2px 8px rgba(0,0,0,.07); border-left:4px solid var(--gold); }
        .match-item.unanswered { border-left-color:var(--red)!important; background:#FFF5F5!important; }
        .match-num { font-family:'Playfair Display',serif; font-size:17px; font-weight:700; color:var(--red); }
        .match-term { font-weight:600; font-size:15px; color:var(--green); }
        .match-select { padding:8px 12px; border:2px solid #DDD; border-radius:6px; font-family:inherit; font-size:13.5px; background:var(--cream); cursor:pointer; min-width:230px; }
        .match-select:focus { outline:none; border-color:var(--red); }
        .section-bonus .section-head { background:linear-gradient(135deg,var(--red-dark),var(--red)); }
        .section-bonus .section-body { border-color:var(--red); background:#FFF8F8; }
        .bonus-badge { display:inline-block; background:var(--gold); color:#3A2A00; padding:3px 12px; border-radius:20px; font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
        .bonus-ta { width:100%; min-height:130px; padding:13px 15px; border:2px solid #DDD; border-radius:8px; font-family:inherit; font-size:14.5px; resize:vertical; background:white; user-select:text; -webkit-user-select:text; }
        .bonus-ta:focus { outline:none; border-color:var(--red); }
        .submit-btn { width:100%; padding:17px; background:linear-gradient(135deg,var(--red-dark),var(--red)); color:white; border:none; border-radius:8px; font-family:'Playfair Display',serif; font-size:20px; font-weight:700; cursor:pointer; margin-top:8px; box-shadow:0 4px 16px rgba(204,0,0,.3); transition:all .2s; }
        .submit-btn:hover { transform:translateY(-2px); box-shadow:0 8px 24px rgba(204,0,0,.4); }
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.85); z-index:1000; justify-content:center; align-items:center; padding:20px; }
        .modal-box { background:white; padding:36px; border-radius:16px; max-width:820px; width:100%; max-height:92vh; overflow-y:auto; animation:fadeUp .35s ease-out; }
        @keyframes fadeUp { from{opacity:0;transform:translateY(-30px)} to{opacity:1;transform:translateY(0)} }
        .score-wrap { text-align:center; margin-bottom:24px; }
        .score-circle { width:180px; height:180px; border-radius:50%; background:linear-gradient(135deg,var(--green),var(--green-mid)); border:6px solid var(--gold); display:flex; flex-direction:column; justify-content:center; align-items:center; margin:0 auto 16px; color:white; box-shadow:0 10px 36px rgba(27,77,46,.3); }
        .score-num { font-family:'Playfair Display',serif; font-size:58px; font-weight:700; line-height:1; }
        .score-lbl { font-size:11px; text-transform:uppercase; letter-spacing:2px; color:var(--gold); margin-top:4px; }
        .score-name { font-size:17px; color:var(--green); font-weight:600; }
        .score-date { font-size:13px; color:var(--gray); margin-top:3px; }
        .score-breakdown { display:grid; grid-template-columns:1fr 1fr; gap:11px; margin-top:18px; }
        .bd-item { background:var(--cream); padding:13px 15px; border-radius:8px; border-left:4px solid var(--green); font-size:14px; }
        .bd-item.gold { border-left-color:var(--gold); }
        .activity { background:#FFFBF0; border:2px solid var(--gold); border-radius:10px; padding:18px; margin:22px 0; }
        .activity h4 { color:#5A4200; font-size:15px; font-weight:700; margin-bottom:13px; }
        .act-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
        .act-box { background:white; padding:13px; border-radius:8px; text-align:center; border:1px solid #EDD98A; }
        .act-num { font-family:'Playfair Display',serif; font-size:28px; font-weight:700; color:var(--red); }
        .act-lbl { font-size:11px; color:#856404; text-transform:uppercase; margin-top:3px; }
        .act-log { margin-top:14px; max-height:170px; overflow-y:auto; background:white; border-radius:6px; padding:11px; font-family:'Courier New',monospace; }
        .log-entry { padding:6px; border-bottom:1px solid #EEE; font-size:12px; color:#555; }
        .log-entry:last-child { border-bottom:none; }
        .log-time { color:var(--green); font-weight:bold; }
        .log-sus { color:var(--red); font-weight:bold; }
        .log-ok { color:var(--green-mid); }
        .review { margin-top:22px; border-top:2px solid #EEE; padding-top:22px; }
        .review h4 { font-family:'Playfair Display',serif; font-size:19px; color:var(--green); text-align:center; margin-bottom:14px; }
        .review-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(64px,1fr)); gap:9px; }
        .r-item { padding:13px 8px; border-radius:8px; text-align:center; font-weight:700; font-size:13px; }
        .r-correct { background:#EDFAF2; border:2px solid #2D6E47; color:var(--green); }
        .r-wrong   { background:#FFF0F0; border:2px solid var(--red); color:var(--red-dark); }
        .r-item .rq { font-size:15px; display:block; margin-bottom:3px; }
        .r-item .rs { font-size:17px; }
        .review-sum { margin-top:14px; padding:13px; background:var(--cream); border-radius:8px; text-align:center; font-size:14px; color:#495057; }
        .ss-notice { background:#F0F7FF; border:2px solid var(--green); border-radius:10px; padding:18px; margin-top:18px; text-align:center; }
        .ss-notice strong { display:block; font-family:'Playfair Display',serif; font-size:17px; color:var(--green); margin-bottom:7px; }
        .ss-notice p { font-size:13.5px; color:#555; }
        .close-btn { display:block; width:100%; padding:14px; margin-top:18px; background:var(--green); color:white; border:none; border-radius:8px; font-family:'Playfair Display',serif; font-size:16px; font-weight:700; cursor:pointer; }
        .close-btn:hover { background:var(--green-mid); }
        @media (max-width:640px) {
            .quiz-inner { padding:24px 18px; }
            .student-info { grid-template-columns:1fr; }
            .act-stats { grid-template-columns:1fr 1fr; }
            .match-item { grid-template-columns:28px 1fr; }
            .match-select { min-width:unset; width:100%; grid-column:1/-1; }
            .score-breakdown { grid-template-columns:1fr; }
        }
    </style>
</head>
<body>
<div class="timer" id="timer"><span class="timer-label">Time Elapsed</span>00:00:00</div>
<div class="tab-overlay" id="tabOverlay">
    <div class="icon">üçÅ</div>
    <h2>TAB SWITCH DETECTED</h2>
    <p>Return to the quiz immediately. This is being recorded for your teacher.</p>
    <div class="vcount" id="tabCount">Violations: 0</div>
</div>
<div class="school-band">
    <div class="name">Maple Leaf World School</div>
    <div style="font-size:26px">üçÅ</div>
</div>
<div class="quiz-wrap">
<div class="quiz-inner">
<div class="warning-banner" id="warningBanner"></div>
<div class="unanswered-msg" id="unansweredMsg">Please answer ALL questions before submitting. / ËØ∑ÂõûÁ≠îÊâÄÊúâÈóÆÈ¢òÂêéÂÜçÊèê‰∫§„ÄÇ</div>
<div class="submitted-msg" id="submittedMsg">Quiz Submitted ‚Äî Please screenshot your results below.</div>

<div class="quiz-header">
    <h1>11-2 Unit 1 ‚Äî Week 1 Quiz</h1>
    <div class="divider"><span>üçÅ</span></div>
    <div class="sub">Reading Strategies ¬∑ English Language Arts ¬∑ Maple Leaf World School</div>
    <div class="student-info">
        <div class="info-field"><label>Student Name / ÂßìÂêç</label><input type="text" id="studentName" autocomplete="off"></div>
        <div class="info-field"><label>Date / Êó•Êúü</label><input type="date" id="quizDate"></div>
    </div>
</div>

<form id="quizForm">

<div class="integrity-notice">
<h3>üçÅ Academic Integrity Rules / Â≠¶ÊúØËØö‰ø°ËßÑÂÆö</h3>
<div class="rule"><span class="rule-icon">üö´</span><span><strong>No AI Tools</strong> ‚Äî Do not use ChatGPT, Claude, or any AI tools.</span></div>
<div class="rule"><span class="rule-icon">üö´</span><span><strong>No Translation Apps</strong> ‚Äî Do not use translation software.</span></div>
<div class="rule"><span class="rule-icon">üö´</span><span><strong>Stay on This Tab</strong> ‚Äî Tab switching is recorded.</span></div>
<div class="rule"><span class="rule-icon">‚úÖ</span><span><strong>Your Own Work Only</strong></span></div>
</div>

<div class="section">
<div class="section-head">
<div class="sec-title">Section A <span>Multiple Choice</span></div>
<div class="sec-desc">Questions 1‚Äì5 ¬∑ Choose the BEST answer.</div>
</div>
<div class="section-body" id="secA"></div>
</div>

<div class="section">
<div class="section-head">
<div class="sec-title">Section B <span>True / False</span></div>
<div class="sec-desc">Questions 6‚Äì10 ¬∑ Âà§Êñ≠ÂØπÈîô</div>
</div>
<div class="section-body" id="secB"></div>
</div>

<div class="section">
<div class="section-head">
<div class="sec-title">Section C <span>Matching</span></div>
<div class="sec-desc">Questions 11‚Äì15 ¬∑ Match each term to its definition.</div>
</div>
<div class="section-body" id="secC"></div>
</div>

<div class="section section-bonus">
<div class="section-head">
<div class="sec-title">Section E <span>Short Answer</span></div>
<div class="sec-desc">Question 21 ¬∑ Higher-Order Thinking</div>
</div>
<div class="section-body">
<div class="q-card" style="border-left-color:var(--gold)">
<div class="q-num">Question 21</div>
<div class="q-text">
<strong>Passage:</strong><br>
Li Wei opened the envelope slowly. Her hands were trembling. The letter inside was from the university she had dreamed of attending for three years. She had studied every night, missed parties with friends, and skipped trips to the mall. Her mother stood quietly in the doorway, watching her daughter's face. Li Wei's eyes moved slowly across the page. Then, she looked up. Her mother saw her daughter's expression and immediately walked to the kitchen to bring out the cake she had been hiding in the refrigerator.
<br><br>
<strong>Part A:</strong> Write ONE inference using the sentence frame:<br>
‚ÄúBecause ___ and ___, I infer that ___.‚Äù
<br><br>
<strong>Part B:</strong> Is the following statement a fact or opinion? Explain your answer.<br>
‚ÄúLi Wei is the hardest-working student in her school.‚Äù
</div>
<textarea class="bonus-ta" name="q21"></textarea>
</div>
</div>
</div>

<button type="submit" class="submit-btn">üçÅ Submit Quiz / Êèê‰∫§ÊµãÈ™å</button>
</form>
</div>
</div>

<div class="modal" id="resultsModal">
<div class="modal-box">
<div class="score-wrap">
<div class="score-circle">
<div class="score-num" id="scoreNum">0</div>
<div class="score-lbl">Points / 100</div>
</div>
<div class="score-name" id="scoreName"></div>
<div class="score-date" id="scoreDate"></div>
<div class="score-breakdown">
<div class="bd-item"><strong>Section A:</strong><br><span id="scoreA">0</span></div>
<div class="bd-item"><strong>Section B:</strong><br><span id="scoreB">0</span></div>
<div class="bd-item"><strong>Section C:</strong><br><span id="scoreC">0</span></div>
<div class="bd-item gold"><strong>Section E:</strong><br>Submitted ‚úì</div>
</div>
</div>

<div class="activity">
<h4>‚ö†Ô∏è Academic Integrity Monitor</h4>
<div class="act-stats">
<div class="act-box"><div class="act-num" id="actTabs">0</div><div class="act-lbl">Tab Switches</div></div>
<div class="act-box"><div class="act-num" id="actTotal">0s</div><div class="act-lbl">Total Away</div></div>
<div class="act-box"><div class="act-num" id="actAvg">0s</div><div class="act-lbl">Avg Per Switch</div></div>
</div>
<div class="act-log" id="actLog"></div>
</div>

<div class="review">
<h4>Question Review</h4>
<div class="review-grid" id="reviewGrid"></div>
<div class="review-sum" id="reviewSum"></div>
</div>

<div class="ss-notice">
<strong>üì∏ Screenshot Required</strong>
<p>Take a screenshot of this results page and submit it to your teacher.</p>
</div>

<button class="close-btn" onclick="closeModal()">Close</button>
</div>
</div>

<script>
const _k={
1:'A guess about what will happen next based on text clues',
2:'Draw a conclusion using clues from the text and your background knowledge',
3:'Creating a mental image of what the author describes',
4:'The Great Wall of China was built over many centuries',
5:'Write only the main ideas in their own words',
6:'F',7:'T',8:'T',9:'F',10:'T',
11:'B',12:'C',13:'D',14:'E',15:'A'
};
const _e={};Object.keys(_k).forEach(k=>{_e[k]=btoa(unescape(encodeURIComponent(_k[k])));});
function chk(id,val){try{return decodeURIComponent(escape(atob(_e[id]))).toLowerCase().trim()==val.toLowerCase().trim();}catch(e){return false;}}

const QA=[
{id:1,text:'What is a prediction?',opts:['A statement that is always true','A guess about what will happen next based on text clues','A summary of the whole text','A personal feeling that cannot be proven']},
{id:2,text:'When you infer, you...',opts:['Copy sentences exactly from the text','Predict the next chapter','Draw a conclusion using clues from the text and your background knowledge','Write only the main idea of the text']},
{id:3,text:'Visualization while reading means...',opts:['Drawing a picture of the cover','Reading the text out loud','Creating a mental image of what the author describes','Finding facts to support an opinion']},
{id:4,text:'Which of the following is a FACT?',opts:['Winter is the most beautiful season','Dogs are better pets than cats','The Great Wall of China was built over many centuries','English is easier than math']},
{id:5,text:'When writing a summary, a student should...',opts:['Include all details from the text','Write only the main ideas in their own words','Add their personal opinion at the end','Copy the first and last sentences of the text']}
];

const QB=[
{id:6,text:'An inference must be directly stated in the text to be correct.'},
{id:7,text:'Text-to-self connections link what you read to your own experiences.'},
{id:8,text:'Predictions should be supported by evidence from the text.'},
{id:9,text:'An opinion can be proven using data or research.'},
{id:10,text:'Visualization helps readers better understand characters and settings.'}
];

const QC=[
{id:11,term:'Inference'},
{id:12,term:'Visualization'},
{id:13,term:'Text Connection'},
{id:14,term:'Summary'},
{id:15,term:'Prediction'}
];

const DEFS=[
{letter:'A',text:'A guess about what will happen next using text clues'},
{letter:'B',text:'A conclusion based on evidence not directly stated in the text'},
{letter:'C',text:'Creating a mental picture while reading'},
{letter:'D',text:'Linking the text to your own life, another book, or the world'},
{letter:'E',text:'A short retelling of only the main ideas in your own words'}
];

function shuffle(a){const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;}

function renderA(){const c=document.getElementById('secA');QA.forEach(q=>{const opts=shuffle(q.opts);const d=document.createElement('div');d.className='q-card';d.dataset.q=q.id;d.innerHTML=`<div class="q-num">Question ${q.id}</div><div class="q-text">${q.text}</div><div class="options">${opts.map(o=>`<label class="opt"><input type="radio" name="q${q.id}" value="${o.replace(/"/g,'&quot;')}"> ${o}</label>`).join('')}</div>`;c.appendChild(d);});}
function renderB(){const c=document.getElementById('secB');QB.forEach(q=>{const d=document.createElement('div');d.className='q-card';d.dataset.q=q.id;d.innerHTML=`<div class="q-num">Question ${q.id}</div><div class="q-text">${q.text}</div><div class="tf-opts"><label class="tf-opt"><input type="radio" name="q${q.id}" value="T"> T ‚Äî True</label><label class="tf-opt"><input type="radio" name="q${q.id}" value="F"> F ‚Äî False</label></div>`;c.appendChild(d);});}
function renderC(){const c=document.getElementById('secC');const defs=shuffle(DEFS);QC.forEach(q=>{const d=document.createElement('div');d.className='match-item';d.dataset.q=q.id;d.innerHTML=`<div class="match-num">${q.id}.</div><div class="match-term">${q.term}</div><select class="match-select" name="q${q.id}"><option value="">‚Äî Select a definition ‚Äî</option>${defs.map(x=>`<option value="${x.letter}">${x.text}</option>`).join('')}</select>`;c.appendChild(d);});}
renderA();renderB();renderC();

document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&['I','J','C','U'].includes(e.key.toUpperCase()))||(e.ctrlKey&&['U','S','P'].includes(e.key.toUpperCase())))e.preventDefault();});

let tabCount=0,totalAway=0,awayStart=null,isAway=false,tabLog=[];
function onLeave(){if(isAway)return;isAway=true;awayStart=Date.now();tabCount++;document.getElementById('warningBanner').style.display='block';document.getElementById('warningBanner').textContent=`Tab switch #${tabCount} detected ‚Äî recorded for teacher review.`;document.getElementById('tabCount').textContent=`Violations: ${tabCount}`;document.getElementById('tabOverlay').classList.add('show');}
function onReturn(){if(!isAway)return;isAway=false;document.getElementById('tabOverlay').classList.remove('show');if(awayStart){const dur=Math.floor((Date.now()-awayStart)/1000);totalAway+=dur;tabLog.push({time:new Date().toLocaleTimeString(),dur,count:tabCount,sus:dur>30});awayStart=null;}}
document.addEventListener('visibilitychange',()=>{document.hidden?onLeave():onReturn();});
window.addEventListener('blur',()=>{setTimeout(()=>{if(!document.hasFocus())onLeave();},150);});
window.addEventListener('focus',()=>{setTimeout(()=>{if(document.hasFocus())onReturn();},150);});

const t0=Date.now();
setInterval(()=>{const s=Math.floor((Date.now()-t0)/1000);const h=String(Math.floor(s/3600)).padStart(2,'0');const m=String(Math.floor((s%3600)/60)).padStart(2,'0');const sc=String(s%60).padStart(2,'0');document.getElementById('timer').innerHTML=`<span class="timer-label">Time Elapsed</span>${h}:${m}:${sc}`;},1000);

document.addEventListener('click',e=>{const opt=e.target.closest('.opt,.tf-opt');if(!opt)return;const inp=opt.querySelector('input');if(!inp)return;document.querySelectorAll(`input[name="${inp.name}"]`).forEach(r=>r.parentElement.classList.remove('selected'));opt.classList.add('selected');});

function fmtTime(s){return s<60?`${s}s`:`${Math.floor(s/60)}m ${s%60}s`;}

document.getElementById('quizForm').addEventListener('submit',e=>{
e.preventDefault();
const name=document.getElementById('studentName').value.trim();
if(!name){alert('Please enter your name.');return;}
const missing=[];
for(let i=1;i<=15;i++){if(i<=10){if(!document.querySelector(`input[name="q${i}"]:checked`))missing.push(i);}else{const s=document.querySelector(`select[name="q${i}"]`);if(!s||!s.value)missing.push(i);}}
document.querySelectorAll('.q-card.unanswered,.match-item.unanswered').forEach(el=>el.classList.remove('unanswered'));
if(missing.length>0){missing.forEach(i=>{const el=document.querySelector(`[data-q="${i}"]`);if(el){el.classList.add('unanswered');el.style.animation='none';el.offsetHeight;el.style.animation='';}});document.getElementById('unansweredMsg').style.display='block';document.querySelector(`[data-q="${missing[0]}"]`).scrollIntoView({behavior:'smooth',block:'center'});return;}
document.getElementById('unansweredMsg').style.display='none';

let sA=0,sB=0,sC=0;const results=[];
for(let i=1;i<=15;i++){let ans='';if(i<=10){const el=document.querySelector(`input[name="q${i}"]:checked`);ans=el?el.value:'';}else{const el=document.querySelector(`select[name="q${i}"]`);ans=el?el.value:'';}const correct=ans!==''&&chk(i,ans);results.push({q:i,correct});if(correct){if(i<=5)sA++;else if(i<=10)sB++;else sC++;}}

const ptA=sA*4,ptB=sB*3,ptC=sC*4,total=ptA+ptB+ptC;
document.getElementById('quizForm').style.display='none';
document.getElementById('submittedMsg').style.display='block';
window.scrollTo(0,0);
document.getElementById('scoreNum').textContent=total;
document.getElementById('scoreA').textContent=`${ptA} pts`;
document.getElementById('scoreB').textContent=`${ptB} pts`;
document.getElementById('scoreC').textContent=`${ptC} pts`;
document.getElementById('scoreName').textContent=name;
document.getElementById('scoreDate').textContent=document.getElementById('quizDate').value||new Date().toLocaleDateString();
document.getElementById('actTabs').textContent=tabCount;
document.getElementById('actTotal').textContent=fmtTime(totalAway);
document.getElementById('actAvg').textContent=tabCount>0?fmtTime(Math.floor(totalAway/tabCount)):'0s';

const logEl=document.getElementById('actLog');
if(tabLog.length>0){logEl.innerHTML=tabLog.map(l=>`<div class="log-entry"><span class="log-time">[${l.time}]</span> Switch #${l.count} ‚Äî away ${l.dur}s ${l.sus?'<span class="log-sus">[SUSPICIOUS]</span>':'<span class="log-ok">[Normal]</span>'}</div>`).join('');}
else{logEl.innerHTML='<div style="color:#aaa;font-style:italic;font-size:13px">No tab switching detected ‚úì</div>';}

const grid=document.getElementById('reviewGrid');grid.innerHTML='';
results.forEach(r=>{const d=document.createElement('div');d.className=`r-item ${r.correct?'r-correct':'r-wrong'}`;d.innerHTML=`<span class="rq">Q${r.q}</span><span class="rs">${r.correct?'‚úì':'‚úó'}</span>`;grid.appendChild(d);});
const nC=results.filter(r=>r.correct).length,nW=results.filter(r=>!r.correct).length;
document.getElementById('reviewSum').innerHTML=`You got <strong>${nC}</strong> correct and <strong>${nW}</strong> incorrect.`;
document.getElementById('resultsModal').style.display='flex';
});

function closeModal(){document.getElementById('resultsModal').style.display='none';}
document.getElementById('quizDate').valueAsDate=new Date();
</script>
</body>
</html>